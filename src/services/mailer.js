const nodemailer = require("nodemailer");
const logo =
  "https://scontent.fktm3-1.fna.fbcdn.net/v/t1.6435-9/93186721_108549450826302_6117819208186200064_n.jpg?_nc_cat=100&ccb=1-4&_nc_sid=09cbfe&_nc_ohc=Xv6Jdb8eQaQAX9VyzU-&tn=7ruQBwVrfBJhQxye&_nc_ht=scontent.fktm3-1.fna&oh=1b904488f8574fd6cabaa5b2d9e8c12f&oe=6135F35A";

const emailVerificationTemplate = (email, token) => {
  return `<!DOCTYPE htmlPUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet"><title>Verify your email address</title><style type="text/css" rel="stylesheet" media="all">/* Base ------------------------------ */*:not(br):not(tr):not(html){font-family: 'Rubik', sans-serif;-webkit-box-sizing: border-box;box-sizing: border-box;}body{width: 100% !important;height: 100%;margin: 0;line-height: 1.4;background-color: #F5F7F9;color: #333;-webkit-text-size-adjust: none;}a{color: #4886B0;}/* Layout ------------------------------ */.email-wrapper{width: 100%;margin: 0;padding: 0;background-color: #F5F7F9;}.email-content{width: 100%;margin: 0;padding: 0;}/* Masthead ----------------------- */.email-masthead{padding: 25px 0;text-align: center;}.email-masthead_logo{max-width: 400px;border: 0;}.email-masthead_name{font-size: 16px;font-weight: bold;color: #839197;text-decoration: none;text-shadow: 0 1px 0 white;}/* Body ------------------------------ */.email-body{width: 100%;margin: 0;padding: 0;border-top: 1px solid #E7EAEC;border-bottom: 1px solid #E7EAEC;background-color: #FFFFFF;}.email-body_inner{width: 570px;margin: 0 auto;padding: 0;}.email-footer{width: 570px;margin: 0 auto;padding: 0;text-align: center;}.email-footer p{color: #839197;}.body-action{width: 100%;margin: 30px auto;padding: 0;text-align: center;}.body-sub{margin-top: 25px;padding-top: 25px;border-top: 1px solid #E7EAEC;}.content-cell{padding: 35px;}.align-right{text-align: right;}/* Type ------------------------------ */h1{margin-top: 0;color: #292E31;font-size: 19px;font-weight: bold;text-align: left;}h2{margin-top: 0;color: #292E31;font-size: 16px;font-weight: bold;text-align: left;}h3{margin-top: 0;color: #292E31;font-size: 14px;font-weight: bold;text-align: left;}p{margin-top: 0;color: #839197;font-size: 16px;line-height: 1.5em;text-align: left;}p.sub{font-size: 12px;}p.center{text-align: center;}/* Buttons ------------------------------ */.button{display: inline-block;width: 200px;background-color: #4886B0;border-radius: 3px;color: #ffffff;font-size: 15px;line-height: 45px;text-align: center;text-decoration: none;-webkit-text-size-adjust: none;mso-hide: all;}.button--green{background-color: #28DB67;}.button--red{background-color: #FF3665;}.button--blue{background-color: #4886B0;}/*Media Queries ------------------------------ */@media only screen and (max-width: 600px){.email-body_inner,.email-footer{width: 100% !important;}}@media only screen and (max-width: 500px){.button{width: 100% !important;}}</style></head><body><table class="email-wrapper" width="100%" cellpadding="0" cellspacing="0"><tr><td align="center"><table class="email-content" width="100%" cellpadding="0" cellspacing="0"><tr><td class="email-masthead"> <a class="email-masthead_name"><imgsrc=${logo} style="width: 125px;" alt="FarmGro"/></a> </td></tr><tr><td class="email-body" width="100%"><table class="email-body_inner" align="center" width="570" cellpadding="0" cellspacing="0"><tr><td class="content-cell"><h1>Verify your email address</h1><p>Thanks for signing up for FarmGro! We're excited to have you as a user.</p><table class="body-action" align="center" width="100%" cellpadding="0" cellspacing="0"><tr><td align="center"><div><a href="${process.env.CLIENT_URL}/email-verify?email=${email}&token=${token}"class="button button--blue">VerifyEmail</a> </div></td></tr></table><p>Thanks,<br>The FarmGro Team</p><table class="body-sub"><tr><td><p class="sub">If you’re having trouble clicking the button, copy and paste the URL below intoyour web browser. </p><p class="sub"><ahref="${process.env.CLIENT_URL}/email-verify?email=${email}&token=${token}">${process.env.CLIENT_URL}/email-verify?email=${email}&token=${token}</a></p></td></tr></table></td></tr></table></td></tr><tr><td><table class="email-footer" align="center" width="570" cellpadding="0" cellspacing="0"><tr><td class="content-cell"><p class="sub center"> FarmGro. <br>Bhatkekopul-Kalopul Road, Chabahil-7, Kathmandu, Nepal</p></td></tr></table></td></tr></table></td></tr></table></body></html>`;
};

const forgotPasswordTemplate = (email, token) => {
  return `<!DOCTYPE htmlPUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet"><title>Reset forgot password request</title><style type="text/css" rel="stylesheet" media="all">/* Base ------------------------------ */*:not(br):not(tr):not(html){font-family: 'Rubik', sans-serif;-webkit-box-sizing: border-box;box-sizing: border-box;}body{width: 100% !important;height: 100%;margin: 0;line-height: 1.4;background-color: #F5F7F9;color: #333;-webkit-text-size-adjust: none;}a{color: #4886B0;}/* Layout ------------------------------ */.email-wrapper{width: 100%;margin: 0;padding: 0;background-color: #F5F7F9;}.email-content{width: 100%;margin: 0;padding: 0;}/* Masthead ----------------------- */.email-masthead{padding: 25px 0;text-align: center;}.email-masthead_logo{max-width: 400px;border: 0;}.email-masthead_name{font-size: 16px;font-weight: bold;color: #839197;text-decoration: none;text-shadow: 0 1px 0 white;}/* Body ------------------------------ */.email-body{width: 100%;margin: 0;padding: 0;border-top: 1px solid #E7EAEC;border-bottom: 1px solid #E7EAEC;background-color: #FFFFFF;}.email-body_inner{width: 570px;margin: 0 auto;padding: 0;}.email-footer{width: 570px;margin: 0 auto;padding: 0;text-align: center;}.email-footer p{color: #839197;}.body-action{width: 100%;margin: 30px auto;padding: 0;text-align: center;}.body-sub{margin-top: 25px;padding-top: 25px;border-top: 1px solid #E7EAEC;}.content-cell{padding: 35px;}.align-right{text-align: right;}/* Type ------------------------------ */h1{margin-top: 0;color: #292E31;font-size: 19px;font-weight: bold;text-align: left;}h2{margin-top: 0;color: #292E31;font-size: 16px;font-weight: bold;text-align: left;}h3{margin-top: 0;color: #292E31;font-size: 14px;font-weight: bold;text-align: left;}p{margin-top: 0;color: #839197;font-size: 16px;line-height: 1.5em;text-align: left;}p.sub{font-size: 12px;}p.center{text-align: center;}/* Buttons ------------------------------ */.button{display: inline-block;width: 200px;background-color: #4886B0;border-radius: 3px;color: #ffffff;font-size: 15px;line-height: 45px;text-align: center;text-decoration: none;-webkit-text-size-adjust: none;mso-hide: all;}.button--green{background-color: #28DB67;}.button--red{background-color: #FF3665;}.button--blue{background-color: #4886B0;}/*Media Queries ------------------------------ */@media only screen and (max-width: 600px){.email-body_inner,.email-footer{width: 100% !important;}}@media only screen and (max-width: 500px){.button{width: 100% !important;}}</style></head><body><table class="email-wrapper" width="100%" cellpadding="0" cellspacing="0"><tr><td align="center"><table class="email-content" width="100%" cellpadding="0" cellspacing="0"><tr><td class="email-masthead"> <a class="email-masthead_name"><imgsrc=${logo} style="width: 125px;" alt="FarmGro"/></a> </td></tr><tr><td class="email-body" width="100%"><table class="email-body_inner" align="center" width="570" cellpadding="0" cellspacing="0"><tr><td class="content-cell"><h1>Password reset request</h1><p>You are receiving this email because we received a password reset request for your account.</p><table class="body-action" align="center" width="100%" cellpadding="0" cellspacing="0"><tr><td align="center"><div><a href="${process.env.CLIENT_URL}/reset-password?email=${email}&token=${token}"class="button button--blue">Reset Password</a> </div></td></tr></table><p>If you did not request a password reset, no further action is required.</p><p></p><p>Thanks,<br>FarmGro Team</p><table class="body-sub"><tr><td><p class="sub">If you’re having trouble clicking the button, copy and paste the URL below into your web browser. </p><p class="sub"><ahref="${process.env.CLIENT_URL}/reset-password?email=${email}&token=${token}">${process.env.CLIENT_URL}/reset-password?email=${email}&token=${token}</a></p></td></tr></table></td></tr></table></td></tr><tr><td><table class="email-footer" align="center" width="570" cellpadding="0" cellspacing="0"><tr><td class="content-cell"><p class="sub center"> FarmGro. <br>Bhatkekopul-Kalopul Road, Chabahil-7, Kathmandu, Nepal</p></td></tr></table></td></tr></table></td></tr></table></body></html>`;
};

exports.transporter = nodemailer.createTransport({
  host: process.env.MAIL_HOST,
  port: process.env.MAIL_PORT,
  auth: {
    user: process.env.MAIL_USERNAME,
    pass: process.env.MAIL_PASSWORD,
  },
});

exports.mailOptions = (email, code, subject, type) => {
  const mail_subject = subject ? subject : "Newsfull Mail Alert";
  let html_template;
  if (type === "forgot_password") {
    html_template = forgotPasswordTemplate(email, code);
  } else if (type === "email_verification") {
    html_template = emailVerificationTemplate(email, code);
  }

  return {
    from: process.env.MAIL_FROM_EMAIL,
    to: email,
    subject: mail_subject,
    html: html_template,
  };
};
